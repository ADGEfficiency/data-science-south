{{ define "main" }}
<div
  class="container mx-auto px-2 pt-1 pb-2 flex flex-col min-h-[calc(100vh-8rem)]"
  data-pagefind-ignore
>
  <div class="p-4 rounded-lg max-w-4xl mx-auto">
    {{/* Introduction text */}}
    <div class="">
      <div class="prose prose-blue dark:prose-invert max-w-none">{{ .Content }}</div>
    </div>
    {{/* View toggle controls - aligned with content */}}
    <div class="mb-4 flex gap-4 items-center flex-wrap" id="view-controls">
      <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Organize by:</span>
      <button
        id="created-year-view-btn"
        class="px-4 py-2 text-sm rounded bg-gray-100 dark:bg-transparent text-gray-700 dark:text-gray-400 hover:bg-gray-800 dark:hover:bg-gray-600 hover:text-white transition-colors duration-200 view-toggle-btn"
      >
        Created
      </button>
      <button
        id="updated-year-view-btn"
        class="px-4 py-2 text-sm rounded bg-gray-100 dark:bg-transparent text-gray-700 dark:text-gray-400 hover:bg-gray-800 dark:hover:bg-gray-600 hover:text-white transition-colors duration-200 view-toggle-btn"
      >
        Updated
      </button>
      <button
        id="competency-view-btn"
        class="px-4 py-2 text-sm rounded bg-gray-100 dark:bg-transparent text-gray-700 dark:text-gray-400 hover:bg-gray-800 dark:hover:bg-gray-600 hover:text-white transition-colors duration-200 view-toggle-btn"
      >
        Topic
      </button>
      <button
        id="type-view-btn"
        class="px-4 py-2 text-sm rounded bg-gray-100 dark:bg-transparent text-gray-700 dark:text-gray-400 hover:bg-gray-800 dark:hover:bg-gray-600 hover:text-white transition-colors duration-200 view-toggle-btn"
      >
        Type
      </button>
      <div class="ml-auto">
        <button
          id="toggle-all-btn"
          class="px-4 py-2 text-sm rounded text-gray-700 dark:text-gray-400 hover:bg-gray-800 dark:hover:bg-gray-600 hover:text-white transition-colors duration-200"
        >
          Expand All
        </button>
      </div>
    </div>
    <div id="content-area" class="opacity-0 transition-opacity duration-200">
    {{/* Competency view */}}
    <div id="competency-view">
      {{/* Get all regular pages (lessons and blog posts) */}} {{ $allPages :=
      where .Site.RegularPages "Type" "in" (slice "lessons" "blog") }} {{/*
      Collect all unique competencies dynamically */}} {{ $competenciesSet :=
      slice }} {{ range $allPages }} {{ range .Params.competencies }} {{
      $competenciesSet = $competenciesSet | append . }} {{ end }} {{ end }} {{
      $competencies := $competenciesSet | uniq | sort }} {{ range $competencies
      }} {{ $competency := . }} {{ $pagesForCompetency := where $allPages
      ".Params.competencies" "intersect" (slice $competency) }} {{ if
      $pagesForCompetency }}
      <div class="collapsible-section">
        <button class="section-header flex items-center justify-between" data-section="{{ $competency | urlize }}">
          <h2 class="text-2xl font-semibold text-gray-800 dark:text-gray-200">
            {{ $competency }}
            <span class="text-sm font-normal text-gray-600 dark:text-gray-400">
              ({{ len $pagesForCompetency }}{{ if eq (len $pagesForCompetency) 1 }} item{{ else }} items{{ end }})
            </span>
          </h2>
          <span class="section-toggle text-gray-500 dark:text-gray-400 text-xl">▼</span>
        </button>
        <div class="section-content grid gap-3 pl-2 pt-2">
          {{ range sort $pagesForCompetency ".Params.date_created" "desc" }} {{ partial "content-card.html" . }} {{ end }}
        </div>
      </div>
      {{ end }} {{ end }} {{/* Handle pages without competencies */}} {{
      $pagesWithoutCompetencies := where $allPages ".Params.competencies" "eq"
      nil }} {{ if $pagesWithoutCompetencies }}
      <div class="collapsible-section">
        <button class="section-header flex items-center justify-between" data-section="other-content">
          <h2 class="text-2xl font-semibold text-gray-800 dark:text-gray-200">
            Other Content
            <span class="text-sm font-normal text-gray-600 dark:text-gray-400">
              ({{ len $pagesWithoutCompetencies }}{{ if eq (len $pagesWithoutCompetencies) 1 }} item{{ else }} items{{ end }})
            </span>
          </h2>
          <span class="section-toggle text-gray-500 dark:text-gray-400 text-xl">▼</span>
        </button>
        <div class="section-content grid gap-3 pl-2 pt-2">
          {{ range sort $pagesWithoutCompetencies ".Params.date_created" "desc" }} {{ partial "content-card.html" . }} {{ end }}
        </div>
      </div>
      {{ end }}
    </div>
    {{/* Created Year view */}}
    <div id="created-year-view" class="hidden">
      {{/* Create a slice to collect unique years */}}
      {{ $years := slice }}
      {{ range $allPages }}
        {{ if .Params.date_created }}
          {{ $date := time .Params.date_created }}
          {{ $year := $date.Year }}
          {{ if not (in $years $year) }}
            {{ $years = $years | append $year }}
          {{ end }}
        {{ end }}
      {{ end }}
      {{/* Sort years descending (most recent first) - manually reverse */}}
      {{ $sortedYears := sort $years }}
      {{ $reversedYears := slice }}
      {{ range $sortedYears }}
        {{ $reversedYears = slice . | append $reversedYears }}
      {{ end }}
      {{ range $reversedYears }}
        {{ $year := . }}
        {{ $yearPages := slice }}
        {{ range $allPages }}
          {{ if .Params.date_created }}
            {{ $date := time .Params.date_created }}
            {{ if eq $date.Year $year }}
              {{ $yearPages = $yearPages | append . }}
            {{ end }}
          {{ end }}
        {{ end }}
        {{ if $yearPages }}
          <div class="collapsible-section">
            <button class="section-header flex items-center justify-between" data-section="created-year-{{ $year }}">
              <h2 class="text-2xl font-semibold text-gray-800 dark:text-gray-200">
                {{ $year }}
                <span class="text-sm font-normal text-gray-600 dark:text-gray-400">
                  ({{ len $yearPages }}{{ if eq (len $yearPages) 1 }} item{{ else }} items{{ end }})
                </span>
              </h2>
              <span class="section-toggle text-gray-500 dark:text-gray-400 text-xl">▼</span>
            </button>
            <div class="section-content grid gap-3 pl-2 pt-2">
              {{ range sort $yearPages ".Params.date_created" "desc" }}
                {{ partial "content-card.html" . }}
              {{ end }}
            </div>
          </div>
        {{ end }}
      {{ end }}
    </div>
    {{/* Updated Year view */}}
    <div id="updated-year-view" class="hidden">
      {{/* Create a slice to collect unique years */}}
      {{ $years := slice }}
      {{ range $allPages }}
        {{ if .Params.date_updated }}
          {{ $date := time .Params.date_updated }}
          {{ $year := $date.Year }}
          {{ if not (in $years $year) }}
            {{ $years = $years | append $year }}
          {{ end }}
        {{ end }}
      {{ end }}
      {{/* Sort years descending (most recent first) - manually reverse */}}
      {{ $sortedYears := sort $years }}
      {{ $reversedYears := slice }}
      {{ range $sortedYears }}
        {{ $reversedYears = slice . | append $reversedYears }}
      {{ end }}
      {{ range $reversedYears }}
        {{ $year := . }}
        {{ $yearPages := slice }}
        {{ range $allPages }}
          {{ if .Params.date_updated }}
            {{ $date := time .Params.date_updated }}
            {{ if eq $date.Year $year }}
              {{ $yearPages = $yearPages | append . }}
            {{ end }}
          {{ end }}
        {{ end }}
        {{ if $yearPages }}
          <div class="collapsible-section">
            <button class="section-header flex items-center justify-between" data-section="updated-year-{{ $year }}">
              <h2 class="text-2xl font-semibold text-gray-800 dark:text-gray-200">
                {{ $year }}
                <span class="text-sm font-normal text-gray-600 dark:text-gray-400">
                  ({{ len $yearPages }}{{ if eq (len $yearPages) 1 }} item{{ else }} items{{ end }})
                </span>
              </h2>
              <span class="section-toggle text-gray-500 dark:text-gray-400 text-xl">▼</span>
            </button>
            <div class="section-content grid gap-3 pl-2 pt-2">
              {{ range sort $yearPages ".Params.date_updated" "desc" }}
                {{ partial "content-card.html" . }}
              {{ end }}
            </div>
          </div>
        {{ end }}
      {{ end }}
    </div>
    {{/* Type view */}}
    <div id="type-view" class="hidden">
      {{/* Get all pages grouped by type */}} {{ $blogPages := where $allPages
      "Type" "blog" }} {{ $lessonPages := where $allPages "Type" "lessons" }}
      {{/* Display blog posts */}} {{ if $blogPages }}
      <div class="collapsible-section">
        <button class="section-header flex items-center justify-between" data-section="type-blog">
          <h2 class="text-2xl font-semibold text-gray-800 dark:text-gray-200">
            Blog Posts
            <span class="text-sm font-normal text-gray-600 dark:text-gray-400">
              ({{ len $blogPages }}{{ if eq (len $blogPages) 1 }} item{{ else }} items{{ end }})
            </span>
          </h2>
          <span class="section-toggle text-gray-500 dark:text-gray-400 text-xl">▼</span>
        </button>
        <div class="section-content grid gap-3 pl-2 pt-2">
          {{ range sort $blogPages ".Params.date_created" "desc" }} {{ partial "content-card.html" . }} {{ end }}
        </div>
      </div>
      {{ end }} {{/* Display lessons */}} {{ if $lessonPages }}
      <div class="collapsible-section">
        <button class="section-header flex items-center justify-between" data-section="type-lessons">
          <h2 class="text-2xl font-semibold text-gray-800 dark:text-gray-200">
            Lessons
            <span class="text-sm font-normal text-gray-600 dark:text-gray-400">
              ({{ len $lessonPages }}{{ if eq (len $lessonPages) 1 }} item{{ else }} items{{ end }})
            </span>
          </h2>
          <span class="section-toggle text-gray-500 dark:text-gray-400 text-xl">▼</span>
        </button>
        <div class="section-content grid gap-3 pl-2 pt-2">
          {{ range sort $lessonPages ".Params.date_created" "desc" }} {{ partial "content-card.html" . }} {{ end }}
        </div>
      </div>
      {{ end }}
    </div>
    </div>
  </div>
</div>
{{/* Include the JavaScript for view toggling */}}
<script src="/js/home-toggle.js"></script>

<style>
.collapsible-section {
  margin-bottom: 1.5rem;
}

.section-header {
  width: 100%;
  text-align: left;
  padding: 0.5rem 1rem;
  border-radius: 0.375rem;
  transition: background-color 0.2s ease;
  border: none;
  background: transparent;
  cursor: pointer;
}

.section-header:hover {
  background-color: #f9fafb;
}

.dark .section-header:hover {
  background-color: #374151;
}

.section-content {
  overflow: hidden;
  transition: max-height 0.3s ease, opacity 0.2s ease;
  max-height: none;
  opacity: 1;
}

.section-content.collapsed {
  max-height: 0;
  opacity: 0;
  padding-top: 0;
  padding-bottom: 0;
  margin-top: 0;
}

.section-toggle {
  transition: transform 0.2s ease;
  display: inline-block;
  min-width: 1.5rem;
}

.collapsed .section-toggle {
  transform: rotate(-90deg);
}
</style>
{{ end }}

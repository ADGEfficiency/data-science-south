{{ define "main" }}
<div
  class="container mx-auto p-2 flex flex-col gap-2 min-h-[calc(100vh-8rem)]"
  data-pagefind-ignore
>
  <div class="p-4 rounded-lg max-w-4xl mx-auto">
    {{/* Introduction text */}}
    <div class="mb-4">
      <div class="prose prose-blue max-w-none">{{ .Content }}</div>
    </div>
    
    {{/* View toggle controls - aligned with content */}}
    <div class="mb-4 flex gap-4 items-center">
      <span class="text-sm font-medium text-gray-700">Organize by:</span>
      <button
        id="competency-view-btn"
        class="px-4 py-2 text-sm rounded bg-gray-800 text-white hover:bg-gray-700 hover:text-white transition-colors duration-200 view-toggle-btn active"
      >
        Competency
      </button>
      <button
        id="year-view-btn"
        class="px-4 py-2 text-sm rounded bg-gray-100 text-gray-700 hover:bg-gray-800 hover:text-white transition-colors duration-200 view-toggle-btn"
      >
        Year
      </button>
      <button
        id="type-view-btn"
        class="px-4 py-2 text-sm rounded bg-gray-100 text-gray-700 hover:bg-gray-800 hover:text-white transition-colors duration-200 view-toggle-btn"
      >
        Type
      </button>
    </div>
    {{/* Competency view */}}
    <div id="competency-view">
      {{/* Get all regular pages (lessons and blog posts) */}} {{ $allPages :=
      where .Site.RegularPages "Type" "in" (slice "lessons" "blog") }} {{/*
      Collect all unique competencies dynamically */}} {{ $competenciesSet :=
      slice }} {{ range $allPages }} {{ range .Params.competencies }} {{
      $competenciesSet = $competenciesSet | append . }} {{ end }} {{ end }} {{
      $competencies := $competenciesSet | uniq | sort }} {{ range $competencies
      }} {{ $competency := . }} {{ $pagesForCompetency := where $allPages
      ".Params.competencies" "intersect" (slice $competency) }} {{ if
      $pagesForCompetency }}
      <div class="mb-6">
        <h2 class="text-2xl font-semibold mb-4 text-gray-800">
          {{ $competency }}
          {{ if gt (len $pagesForCompetency) 1 }}
          <span class="text-sm font-normal text-gray-600"
            >({{ len $pagesForCompetency }} items)</span
          >
          {{ end }}
        </h2>
        <div class="grid gap-3 pl-2">
          {{ range $pagesForCompetency.ByTitle }} {{ partial "content-card.html"
          . }} {{ end }}
        </div>
      </div>
      {{ end }} {{ end }} {{/* Handle pages without competencies */}} {{
      $pagesWithoutCompetencies := where $allPages ".Params.competencies" "eq"
      nil }} {{ if $pagesWithoutCompetencies }}
      <div class="mb-6">
        <h2 class="text-2xl font-semibold mb-4 text-gray-800">
          Other Content
          {{ if gt (len $pagesWithoutCompetencies) 1 }}
          <span class="text-sm font-normal text-gray-600"
            >({{ len $pagesWithoutCompetencies }} items)</span
          >
          {{ end }}
        </h2>
        <div class="grid gap-3 pl-2">
          {{ range $pagesWithoutCompetencies.ByTitle }} {{ partial
          "content-card.html" . }} {{ end }}
        </div>
      </div>
      {{ end }}
    </div>
    {{/* Year view */}}
    <div id="year-view" class="hidden">
      {{/* Get all pages with dates (primarily blog posts) and lessons (which
      don't have dates) */}} {{ $datedPages := where $allPages ".Date" "!=" nil
      }} {{ $undatedPages := where $allPages ".Date" "eq" nil }} {{ $pagesByYear
      := $datedPages.GroupByDate "2006" "desc" }} {{ range $pagesByYear }}
      <div class="mb-6">
        <h2 class="text-2xl font-semibold mb-4 text-gray-800">
          {{ .Key }}
          {{ if gt (len .Pages) 1 }}
          <span class="text-sm font-normal text-gray-600"
            >({{ len .Pages }} items)</span
          >
          {{ end }}
        </h2>
        <div class="grid gap-3 pl-2">
          {{ range .Pages.ByDate.Reverse }} {{ partial "content-card.html" . }}
          {{ end }}
        </div>
      </div>
      {{ end }} {{/* Handle undated content (lessons) */}} {{ if $undatedPages
      }}
      <div class="mb-6">
        <h2 class="text-2xl font-semibold mb-4 text-gray-800">
          Lessons
          {{ if gt (len $undatedPages) 1 }}
          <span class="text-sm font-normal text-gray-600"
            >({{ len $undatedPages }} items)</span
          >
          {{ end }}
        </h2>
        <div class="grid gap-3 pl-2">
          {{ range $undatedPages.ByTitle }} {{ partial "content-card.html" . }}
          {{ end }}
        </div>
      </div>
      {{ end }}
    </div>
    {{/* Type view */}}
    <div id="type-view" class="hidden">
      {{/* Get all pages grouped by type */}}
      {{ $blogPages := where $allPages "Type" "blog" }}
      {{ $lessonPages := where $allPages "Type" "lessons" }}
      
      {{/* Display blog posts */}}
      {{ if $blogPages }}
      <div class="mb-6">
        <h2 class="text-2xl font-semibold mb-4 text-gray-800">
          Blog Posts
          {{ if gt (len $blogPages) 1 }}
          <span class="text-sm font-normal text-gray-600"
            >({{ len $blogPages }} items)</span
          >
          {{ end }}
        </h2>
        <div class="grid gap-3 pl-2">
          {{ range $blogPages.ByDate.Reverse }} {{ partial "content-card.html" . }} {{ end }}
        </div>
      </div>
      {{ end }}
      
      {{/* Display lessons */}}
      {{ if $lessonPages }}
      <div class="mb-6">
        <h2 class="text-2xl font-semibold mb-4 text-gray-800">
          Lessons
          {{ if gt (len $lessonPages) 1 }}
          <span class="text-sm font-normal text-gray-600"
            >({{ len $lessonPages }} items)</span
          >
          {{ end }}
        </h2>
        <div class="grid gap-3 pl-2">
          {{ range $lessonPages.ByDate.Reverse }} {{ partial "content-card.html" . }} {{ end }}
        </div>
      </div>
      {{ end }}
    </div>
  </div>
</div>
{{/* Include the JavaScript for view toggling */}}
<script src="/js/home-toggle.js"></script>
{{ end }}
